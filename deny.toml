# cargo-deny configuration for WARP
# https://embarkstudios.github.io/cargo-deny/

[graph]
# Target platforms to check
targets = [
    "x86_64-unknown-linux-gnu",
    "aarch64-unknown-linux-gnu",
    "x86_64-apple-darwin",
    "aarch64-apple-darwin",
]
all-features = false
no-default-features = false

[output]
feature-depth = 1

# Advisory database configuration
[advisories]
ignore = [
    # Transitive dependencies from sled - will be fixed when sled updates
    { id = "RUSTSEC-2025-0057", reason = "fxhash is transitive via sled, no action possible" },
    { id = "RUSTSEC-2024-0384", reason = "instant is transitive via sled's parking_lot, no action possible" },
    # Transitive from indicatif
    { id = "RUSTSEC-2025-0119", reason = "number_prefix is transitive via indicatif, awaiting upstream fix" },
    # rustls-pemfile - will migrate to rustls-pki-types in future update
    { id = "RUSTSEC-2025-0134", reason = "rustls-pemfile migration planned, tracked in TODO.md" },
]

# License checking configuration
[licenses]
# Licenses we explicitly allow
allow = [
    "MIT",
    "Apache-2.0",
    "Apache-2.0 WITH LLVM-exception",
    "BSD-2-Clause",
    "BSD-3-Clause",
    "ISC",
    "Zlib",
    "0BSD",
    "CC0-1.0",
    "BSL-1.0",
    "MPL-2.0",
    "Unicode-DFS-2016",
    "Unicode-3.0",
    "Unlicense",
    "CDLA-Permissive-2.0",  # webpki-roots certificate data
]
confidence-threshold = 0.8
exceptions = []

# Clarify license for crates that are not auto-detected
[[licenses.clarify]]
crate = "ring"
expression = "MIT AND ISC AND OpenSSL"
license-files = [{ path = "LICENSE", hash = 0xbd0eed23 }]

[licenses.private]
ignore = true
registries = []

# Crate bans configuration
[bans]
multiple-versions = "warn"
# Allow wildcards for workspace path dependencies
wildcards = "allow"
highlight = "all"
workspace-default-features = "allow"
external-default-features = "allow"
allow = []
allow-workspace = true

# Deny specific crates
deny = [
    # Prefer rustls over openssl - but allow when pulled via native-tls for dev/test
    { crate = "openssl", wrappers = ["native-tls"], reason = "Use rustls for production TLS" },
    { crate = "openssl-sys", wrappers = ["native-tls", "openssl"], reason = "Use rustls for production TLS" },
]

skip = []
skip-tree = []

# Source checking configuration
[sources]
unknown-registry = "warn"
unknown-git = "warn"
allow-registry = ["https://github.com/rust-lang/crates.io-index"]
allow-git = []

[sources.allow-org]
github = []
gitlab = []
bitbucket = []
